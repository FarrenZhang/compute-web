<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TACC | Scalable AI Infrastructure Designed for Evolving Machine Learning Research</title>
    
    <!-- Bluma CSS and Bliss JS-->
    <script src="assets/bliss.js"></script>
    <link rel="stylesheet" href="assets/bulma.min.css">

    <!-- TACC Theme files -->
    <link href="assets/tacc-theme.css" rel="stylesheet">
    <script src="assets/tacc-theme.js"></script>
    
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/99d5980073.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="menubar">
        <div class="container">
            <div class="columns is-multiline is-desktop is-align-items-center is-justify-content-center">
                <div class="column is-narrow logo has-text-centered"><img src="./assets/tacc-logo.png"></div>
                <div class="column has-text-centered">
                    <div class="columns is-mobile is-align-items-center items is-multiline">
                        <div class="column is-narrow item"><a href="#">Jobs</a></div>
                        <div class="column is-narrow item"><a href="#">Storage</a></div>
                        <div class="column is-narrow item"><a href="#">Images</a></div>
                        <div class="column is-narrow item"><a href="#">Space</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="section launchpad">
        <div class="container">
            <div class="options">
                <div class="option">
                    <div class="image"><i class="fa-solid fa-book"></i></div>
                    <div class="text">
                        <div class="line1">Quick Launch</div>
                        <div class="line2">Create a quick runtime as a notebook</div>
                    </div>
                </div>
                <div class="option">
                    <div class="image"><i class="fa-solid fa-list-check"></i></div>
                    <div class="text">
                        <div class="line1">Launch</div>
                        <div class="line2">Choose your runtime specifications</div>
                    </div>
                </div>
                <div class="option">
                    <div class="image"><i class="fa-solid fa-database"></i></div>
                    <div class="text">
                        <div class="line1">Manage Storage</div>
                        <div class="line2">Access your cloud storage for all jobs</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section content"> 
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                function action(event, id){
                    return (e)=>{
                        e.stopPropagation(); // so that the table row will not expand
                        alert(`Trigger ${event} ${id}`);
                    }
                };

                function row_render(data, table){
                    var header = ["Namespace", "Container ID", "Container Name", "Creation Time", "CPU Limit", "Memory Limit", "GPU Limit", "Status", "Action"];
                    var result = []
                    var display = $.create("tr", {
                        events: {
                            click: function(){
                                var expanded = this.nextElementSibling;
                                if (expanded.style.visibility === "visible") {
                                    expanded.style.visibility = "collapse";
                                } else {
                                    expanded.style.visibility = "visible";
                                }
                            }
                        },
                        contents: header.map((key) =>
                            ({
                                tag:"td", contents: (()=>{
                                    console.log(key);
                                    switch (key) {
                                        case "Status":
                                            return $.create("span", {
                                                className: "badge " + data[key].toLowerCase(),
                                                contents: data[key]
                                            });
                                        case "Action":
                                            return $.create("div", {
                                                className: "actions",
                                                contents: [
                                                    {   tag: "div",
                                                        events: {
                                                            click: action("edit", data["Container ID"])
                                                        },
                                                        contents: {
                                                            tag:"i", 
                                                            className: "fa-regular fa-pen-to-square"
                                                        }
                                                    },
                                                    {   tag: "div", 
                                                        events: {
                                                            click: action("stop", data["Container ID"])
                                                        },
                                                        contents: {
                                                            tag:"i", 
                                                            className: "fa-solid fa-ban"
                                                        }
                                                    },
                                                ]
                                            });
                                        default:
                                            return data[key];
                                    }
                                })(),
                            })
                        )
                    });
                    var expanded = $.create("tr", {
                        contents: { 
                            tag: "td",
                            colspan: header.length,
                            contents: {
                                tag: "div",
                                contents: JSON.stringify(data),
                            },
                        },
                        style: {visibility: "collapse"},
                    });
                    result.push(display);
                    result.push(expanded);
                    return result;
                }

                function header_render(){
                    var header = ["Namespace", "Container ID", "Container Name", "Creation Time", "CPU", "Memory", "GPU", "Status", "Action"];
                    return $.create("thead", {
                        tags: "tr",
                        contents: header.map((key) =>
                            ({tag:"th", contents: key})
                        )
                    });
                }

                function fetchPodInfo() {
                    fetch("http://localhost:50000/pods")
                        .then(response => response.json())
                        .then(response => {
                            var row_data = []
                            Object.keys(response).forEach(function(namespace) {
                                row_data.push(...response[namespace])
                            });
                            tacc.render_table(
                                response, 
                                row_data, 
                                header_render,
                                row_render,
                                ".main-table"
                            );
                        })
                        .catch(error => {
                            var response = {'demo-project': [{'Namespace': 'demo-project', 'Container ID': '2811db29', 'Container Name': 'container-cmljsf', 'Creation Time': '2024-07-24 17:23:39', 'CPU Limit': '10', 'Memory Limit': '1Gi', 'GPU Limit': '0', 'CPU Request': '10', 'Memory Request': '1Gi', 'GPU Request': '0', 'Status': 'Running', 'Start Time': '2024-07-24 17:23:39', 'Image': 'nginx:stable-perl', 'Image ID': '3614a555', 'Node': 'cpu02', 'Pod IP': '10.233.126.30', 'Creator': 'project-admin', 'Cluster': 'Your_Cluster_Name', 'Storage': {'kube-api-access-5xstk': '/var/run/secrets/kubernetes.io/serviceaccount'}}, {'Namespace': 'demo-project', 'Container ID': 'bc3623f7', 'Container Name': 'nginx', 'Creation Time': '2024-07-24 19:15:29', 'CPU Limit': '1', 'Memory Limit': '100Mi', 'GPU Limit': 'N/A', 'CPU Request': '1', 'Memory Request': '100Mi', 'GPU Request': 'N/A', 'Status': 'Running', 'Start Time': '2024-07-24 19:15:29', 'Image': 'nginx:stable-perl', 'Image ID': '3614a555', 'Node': 'cpu02', 'Pod IP': '10.233.126.31', 'Creator': 'project-admin', 'Cluster': 'Your_Cluster_Name', 'Storage': {'kube-api-access-g7m9x': '/var/run/secrets/kubernetes.io/serviceaccount'}}]};
                            var row_data = []
                            Object.keys(response).forEach(function(namespace) {
                                row_data.push(...response[namespace])
                            });
                            tacc.render_table(
                                response, 
                                row_data, 
                                header_render,
                                row_render,
                                ".main-table"
                            );
                        });
                }
                // Fetch and render the table on page load
                fetchPodInfo();
            });
        </script>
        <div class="container table main-table">
        </div>
    </section>

    <footer class="section footer">
        <div class="container">
            <div class="columns content">
                <div class="column items is-3">
                    <div class="item item-title">TACC Workflow</div>
                    <div class="item">Launch & Monitor AI Jobs</div>
                    <div class="item">Access Cloud Storage</div>
                    <div class="item">Manage Code & Scripts</div>
                </div>
                <div class="column items is-3">
                    <div class="item item-title">TACC Space</div>
                    <div class="item">Latest Public Images</div>
                    <div class="item">Public Dataset</div>
                    <div class="item">Discussion Groups</div>
                </div>
                <div class="column items is-3">
                    <div class="item item-title">Research</div>
                    <div class="item">AI-centric Networking</div>
                    <div class="item">Machine Learning Systems</div>
                    <div class="item">Cluster Resource Scheduling</div>
                </div>
                <div class="column items is-3">
                    <div class="item item-title">Company</div>
                    <div class="item">Our Team</div>
                    <div class="item">Careers</div>
                    <div class="item">HKUST iSING Lab</div>
                </div>
            </div>
            <div class="columns is-align-items-center">
                <div class="column is-narrow logo"><img src="assets/tacc-logo.png" /></div>
                <div class="column copyright is-narrow">星畅 © 2020–2024</div>
            </div>
        </div>
    </footer>
</body>
</html>
